{"version":3,"sources":["../src/components.js"],"names":["Layer","namespace","store","dispatch","createClass","propTypes","use","array","componentWillMount","props","register","id","children","mountPointId","showInitially","show","initialArgs","setArgs","shouldComponentUpdate","newProps","needUpdate","toString","length","i","equals","JSON","stringify","componentWillUnmount","render","LayerStackMountPoint","mountPointArgs","args","elementType","renderFn","views","displaying","hide","hideAll","map","index","key","view","showOnlyMe","Error","LayerToggle","isActive","indexOf","for"],"mappings":"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","file":"components.js","sourcesContent":["import React, { PropTypes, createElement} from 'react'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\n\nimport { ACTIONS } from './reducer'\nimport { isPrimitiveType } from './helpers'\n\nexport const Layer = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)((React.createClass({\n  propTypes: {\n    use: PropTypes.array\n  },\n\n  componentWillMount() {\n    this.props.register(this.props.id, this.props.children, this.props.mountPointId);\n    if (this.props.showInitially) {\n      this.props.show(this.props.id, ...(this.props.initialArgs || []))\n    } else {\n      this.props.setArgs(this.props.id, ...(this.props.initialArgs || []))\n    }\n  },\n  shouldComponentUpdate(newProps) {\n    const { children, register, id, mountPointId, use } = this.props;\n    let needUpdate = false;\n    if (id !== newProps.id || mountPointId !== newProps.mountPointId) {\n      needUpdate = true;\n    }\n    else if (children.toString() !== newProps.children.toString()) {\n      needUpdate = true;\n    }\n    else if (use) {\n      if (use.length !== newProps.use.length) {\n        needUpdate = true;\n      } else {\n        let i = use.length;\n        while (i--) {\n          debugger;\n          if (isPrimitiveType(use[i]) && isPrimitiveType(newProps.use[i])) {\n            if (use[i] !== newProps.use[i]) {\n              needUpdate = true\n            }\n          }\n          else if (typeof use[i].equals === 'function' && typeof newProps.use[i].equals === 'function') {\n            if (!use[i].equals(newProps.use[i])) { // fast equality check for immutable-js && mori\n              needUpdate = true;\n            }\n          }\n          else if (JSON.stringify(use[i]) !== JSON.stringify(newProps.use[i])) {\n            needUpdate = true;\n          }\n        }\n      }\n    }\n\n    if (needUpdate) {\n      register(newProps.id, newProps.children, newProps.mountPointId);\n      return true;\n    }\n    return false;\n  },\n\n  componentWillUnmount() {\n    // TODO: garbage collection\n    // this.props.unregister(this.props.id)\n  },\n\n  render() {\n    return null;\n  }\n})));\n\nexport const LayerStackMountPoint = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({\n  id: mountPointId, args: mountPointArgs, elementType = 'span', // from props\n  renderFn, views, displaying, show, hide, hideAll // from store\n}) => {\n  return createElement(elementType, {}, renderFn ? renderFn({views, displaying, show, hide, hideAll, mountPointId, mountPointArgs}) // it's possible to provide alternative renderFn for the MountPoint\n      : displaying.map ((id, index) => // if no alternative renderFn provided we'll use the default one\n          createElement(elementType, { key: id }, (() => {\n            const view = views[id];\n            if (view && view.renderFn && view.mountPointId === mountPointId) {\n              return view.renderFn({\n                index, id, hideAll, displaying, views, mountPointArgs, // seems like there is no valid use-case mountPointId in the Layer render function\n                showOnlyMe: (...args) => hideAll() || show(id, ...args), // TODO: think about improvement\n                hide: () => hide(id), // intention here is to hide ID's management from Layer and let app developer manage these IDs independently\n                // which will give an ability to write general-purpose Layers and share them b/w projects\n                show: (...args) => show(id, ...args) // sometimes you may want to change args of the current layer\n              }, ...view.args)\n            }\n            if (typeof view === 'undefined' || typeof view.renderFn === 'undefined') {\n              throw new Error(`\n    It seems like you're using LayerToggle with id=\"${ id }\" but corresponding Layer isn't declared in the current Components tree.\n    Make sure that Layer with id=\"${ id }\" is rendered into the current tree.\n    `\n              )\n            }\n          })())))\n});\n\nexport const LayerToggle = (namespace = 'layer_stack') => connect(\n  (store) => store[namespace],\n  dispatch => bindActionCreators(ACTIONS, dispatch)\n)(({\n  children, // from props\n  displaying, show, hide, hideAll, views, ...props, // from store\n}) => {\n  return children({\n    hideAll, displaying, views,\n    isActive: displaying.indexOf(props.for) !== -1,\n    show: (...args) => props.for ? show(props.for, ...args) : show(...args),\n    showOnlyMe: (...args) => hideAll() || show(props.for, ...args),\n    hide: (...args) => props.for ? hide(props.for, ...args) : hide(...args),\n  }, ...views[props.for].args);\n});"]}