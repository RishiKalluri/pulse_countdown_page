{"version":3,"sources":["../src/Layer.js"],"names":["Layer","props","context","layerStore","register","id","children","to","use","defaultArgs","defaultShow","newProps","needUpdate","toString","length","i","equals","JSON","stringify","updateFn","elementType","propTypes","array","defaultProps","contextTypes","object"],"mappings":"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","file":"Layer.js","sourcesContent":["import React, { Component, PropTypes, createElement} from 'react';\nimport { isPrimitiveType } from './helpers';\nimport LayerStore from './LayerStore';\nimport LayerMountPoint from './LayerMountPoint';\n\nexport default class Layer extends Component {\n\n  layerStore: LayerStore;\n\n  constructor(props, context) {\n    super(props, context);\n    this.layerStore = context.layerStore;\n  }\n\n  componentWillMount() {\n    const { layerStore } = this.context;\n    layerStore.register(this.props.id, this.props.children, this.props.to, null, this.use, this.defaultArgs, this.defaultShow);\n  }\n\n  shouldComponentUpdate(newProps) {\n    const { children, id, to, use } = this.props;\n    const { layerStore } = this.context;\n    let needUpdate = false;\n    if (id !== newProps.id || to !== newProps.to) {\n      needUpdate = true;\n    }\n    else if (children.toString() !== newProps.children.toString()) {\n      needUpdate = true;\n    }\n    else if (use) {\n      if (use.length !== newProps.use.length) {\n        needUpdate = true;\n      } else {\n        let i = use.length;\n        while (i--) {\n          if (isPrimitiveType(use[i]) && isPrimitiveType(newProps.use[i])) {\n            if (use[i] !== newProps.use[i]) {\n              needUpdate = true\n            }\n          }\n          else if (typeof use[i].equals === 'function' && typeof newProps.use[i].equals === 'function') {\n            if (!use[i].equals(newProps.use[i])) { // fast equality check for immutable-js && mori\n              needUpdate = true;\n            }\n          }\n          else if (JSON.stringify(use[i]) !== JSON.stringify(newProps.use[i])) {\n            needUpdate = true;\n          }\n        }\n      }\n    }\n\n    if (needUpdate) {\n      layerStore.updateFn(newProps.id, newProps.children, newProps.to, null, newProps.use, newProps.defaultArgs, newProps.defaultShow);\n      return true;\n    }\n    return false;\n  }\n\n  componentWillUnmount() {\n    this.layerStore = null;\n  }\n\n  render() {\n    const { id, to, elementType } = this.props;\n    if (!to) {\n      return createElement(LayerMountPoint, { id });\n    }\n    return null;\n  }\n}\n\nLayer.propTypes = {\n  use: PropTypes.array\n};\n\nLayer.defaultProps = {\n  elementType: 'span'\n};\n\nLayer.contextTypes = {\n  layerStore: PropTypes.object\n};"]}